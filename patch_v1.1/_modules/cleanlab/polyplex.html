<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" />

    <link rel="shortcut icon" href="../../_static/logo.png"/><meta name="generator" content="sphinx-4.4.0, furo 2022.01.02"/>
        <title>cleanlab.polyplex - cleanlab Docs</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">cleanlab Docs</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">cleanlab Docs</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html">Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.latent_estimation">Latent Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.noise_generation">Noise Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.baseline_methods">Baseline Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.coteaching">Co-Teaching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.latent_algebra">Latent Algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.pruning">Pruning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.util">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cleanlab.html#module-cleanlab.polyplex">Polyplex</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../cleanlab.html#models">Models</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../cleanlab.models.html">cleanlab.models package</a></li>
</ul>
</li>
</ul>

</div>


<div class="sidebar-tree">
  <p class="caption" role="heading">
    <span class="caption-text">Tags</span>
  </p>
  <ul>
    
    <li class="toctree-l1">
      <a class="reference internal" href="../../../v1.0.1/index.html">v1.0.1</a>
    </li>
    
  </ul>
</div>

</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for cleanlab.polyplex</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2017-2022  Cleanlab Inc.</span>
<span class="c1"># This file is part of cleanlab.</span>
<span class="c1"># </span>
<span class="c1"># cleanlab is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Affero General Public License as published</span>
<span class="c1"># by the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1"># </span>
<span class="c1"># cleanlab is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Affero General Public License for more details.</span>
<span class="c1"># </span>
<span class="c1"># You should have received a copy of the GNU Affero General Public License</span>
<span class="c1"># along with cleanlab.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>


<span class="c1"># ## The Polyplex</span>
<span class="c1"># </span>
<span class="c1"># ### The polyplex is a geometric solution for the domain of $trace (P_{s,y})$ given $trace (P_{s \vert y})$ for some the latent prior $p(y)$. Like the simplex, the polyplex describes the domain of a probabilistic quantity, but unlike the simplex, the coordinates need not sum to one and the shape is instead defined by a convex polyhedron, hence the name. Understanding the domain of the trace, as opposed to the matrices themselves, is of fundamental importance to confident learning because the diagonal terms of these matrices are what determine learnability and the class re-weighting coefficients. Polyplices connect our learnability theory with our algorithms. Consider the canonical example when $trace (P_{s \vert y}) = m$, then $P_{s \vert y}=\mathbf{I}$ and all noise rates (non-diagonal entries) are zero. Thus, $P_{s,y} = \mathbf{I}$ and $trace (P_{s,y}) = m$. In this vacuous example, $s = y, p(s) = p(y), P_{s,y} = \mathbf{I} \cdot p(s)$, and $P_{y \vert s} = P_{s \vert y} = \mathbf{I}$, all of which was determined from the trace. The role of the polyplex is to generalize to non-vacuous cases by using the geometry of confident learning to solve for $trace (P_{s,y})$ given $trace (P_{s \vert y})$ for some $p(y)$.</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span><span class="p">,</span> \
    <span class="n">unicode_literals</span><span class="p">,</span> <span class="n">with_statement</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="slope_intercept"><a class="viewcode-back" href="../../cleanlab.html#cleanlab.polyplex.slope_intercept">[docs]</a><span class="k">def</span> <span class="nf">slope_intercept</span><span class="p">(</span><span class="n">point1</span><span class="p">,</span> <span class="n">point2</span><span class="p">):</span>
    <span class="sd">'''Returns the slope and intercept between point1 and point2.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    point1 : tuple</span>
<span class="sd">       e.g. (1.3, 4)</span>

<span class="sd">    point2 : tuple</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">      A tuple(slope, intercept)'''</span>

    <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span> <span class="o">=</span> <span class="n">point1</span>
    <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">)</span> <span class="o">=</span> <span class="n">point2</span>
    <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span>
    <span class="n">intercept</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">x1</span>
    <span class="k">return</span> <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span></div>


<div class="viewcode-block" id="joint_bounds"><a class="viewcode-back" href="../../cleanlab.html#cleanlab.polyplex.joint_bounds">[docs]</a><span class="k">def</span> <span class="nf">joint_bounds</span><span class="p">(</span><span class="n">py</span><span class="p">):</span>
    <span class="sd">'''Computes three lists: noise_matrix_trace, joint_trace_min, joint_trace_max that when</span>
<span class="sd">    plotted, the noise_matrix_trace values represent x-values and the joint_trace_min and</span>
<span class="sd">    joint_trace_max values represent the y-value min and maximium ranges. Together, these</span>
<span class="sd">    three lists fully characterize the polyplex.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    py : np.array (shape (K, 1))</span>
<span class="sd">        The fraction (prior probability) of each true, hidden class label, P(y = k)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        A tuple of lists of floats (noise_matrix_trace, joint_trace_min, joint_trace_max)</span>
<span class="sd">        each of length K+1, where K = len(py). When plotted, the noise_matrix_trace values</span>
<span class="sd">        represent x-values and the joint_trace_min and joint_trace_max values represent the</span>
<span class="sd">        y-value min and maximium ranges. These three lists fully characterize the polyplex.'''</span>

    <span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">py</span><span class="p">)</span>
    <span class="n">py</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">py</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">noise_matrix_trace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">K</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">joint_trace_min</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">py</span><span class="p">:</span>
        <span class="n">joint_trace_min</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">-=</span> <span class="n">p</span>
    <span class="n">joint_trace_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">joint_trace_min</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">joint_trace_max</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">joint_trace_min</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">noise_matrix_trace</span><span class="p">,</span> <span class="n">joint_trace_min</span><span class="p">,</span> <span class="n">joint_trace_max</span></div>


<div class="viewcode-block" id="joint_min_max"><a class="viewcode-back" href="../../cleanlab.html#cleanlab.polyplex.joint_min_max">[docs]</a><span class="k">def</span> <span class="nf">joint_min_max</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">,</span> <span class="n">py</span><span class="p">):</span>
    <span class="sd">'''Computes the min and max bounds on the trace(P_{s,y}), the trace of the</span>
<span class="sd">    joint distribution, given the trace of the noise matrix and p(y).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    noise_matrix_trace : float</span>
<span class="sd">        The sum of the diagonals of the noise matrix P(s = k' | y = k)</span>
<span class="sd">    py : np.array (shape (K, 1))</span>
<span class="sd">        The fraction (prior probability) of each true, hidden class label, P(y = k)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        A tuple of two floats (y_min, y_max) representing the bounds on the trace of the joint.'''</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">y_mins</span><span class="p">,</span> <span class="n">y_maxs</span> <span class="o">=</span> <span class="n">joint_bounds</span><span class="p">(</span><span class="n">py</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)</span> <span class="o">==</span> <span class="n">noise_matrix_trace</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y_mins</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)],</span> <span class="n">y_maxs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slope_min</span> <span class="o">=</span> <span class="n">y_mins</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_mins</span><span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)]</span>
        <span class="n">y_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">noise_matrix_trace</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">))</span> <span class="o">*</span> <span class="n">slope_min</span> <span class="o">+</span> \
                <span class="n">y_mins</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)]</span>
        <span class="n">slope_max</span> <span class="o">=</span> <span class="n">y_maxs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_maxs</span><span class="p">[</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)]</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">noise_matrix_trace</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">))</span> <span class="o">*</span> <span class="n">slope_max</span> <span class="o">+</span> \
                <span class="n">y_maxs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">noise_matrix_trace</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>

        <div class="related-information">
              Copyright &#169; 2022, Cleanlab Inc. |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    </body>
</html>